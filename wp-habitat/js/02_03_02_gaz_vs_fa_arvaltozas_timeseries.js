var margin_020302={top:50,right:50,bottom:50,left:60},w_020302=d3.select("#topic02-vis03-part02").node().getBoundingClientRect().width-margin_020302.left-margin_020302.right,h_020302=d3.select("#topic02-vis03-part02").node().getBoundingClientRect().height-margin_020302.top-margin_020302.bottom,parseDate_020302=d3.timeParse("%Y%m%d"),scaleX_020302=d3.scaleTime().range([0,w_020302]),scaleY_020302=d3.scaleLinear().range([h_020302,0]),color_020302=d3.scaleOrdinal().range(["#385988","#43B02A","#FF671F","#A4343A"]),xAxis_020302=d3.axisBottom().scale(scaleX_020302),yAxis_020302=d3.axisLeft().scale(scaleY_020302),line_020302=d3.line().x(function(t){return scaleX_020302(t.date)}).y(function(t){return scaleY_020302(t.ydata)}),svg_020302=d3.select("#topic02-vis03-part02").append("svg").attr("width",w_020302+margin_020302.left+margin_020302.right).attr("height",h_020302+margin_020302.top+margin_020302.bottom).append("g").attr("transform","translate("+margin_020302.left+", "+margin_020302.top+")");function type_020302(t,e,a){t.date=parseDate_020302(t.date);for(var n=1,r=a.length,s;n<r;++n)t[s=a[n]]=+t[s];return t}d3.tsv("/wp-habitat/data/02_lakasminoseg_energiaszegenyseg/02_03_02_gaz_vs_fa_arvaltozas_timeseries.tsv",type_020302,function(t,a){var e,n,r,s,c,o;if(t)throw t;e=a.columns.slice(1).map(function(e){return{name:e,values:a.map(function(t){return{date:t.date,ydata:t[e]}})}}),scaleX_020302.domain(d3.extent(a,function(t){return t.date})),scaleY_020302.domain([d3.min(e,function(t){return d3.min(t.values,function(t){return 1.15*t.ydata})}),d3.max(e,function(t){return d3.max(t.values,function(t){return 1.15*t.ydata})})]),console.log("categories_020302",e),(n=svg_020302.selectAll("g").data(e).enter().append("g").attr("class","legend")).append("rect").attr("x",w_020302-185).attr("y",function(t,e){return 20*e}).attr("width",2).attr("height",15).style("fill",function(t){return color_020302(t.name)}),n.append("text").attr("font-size",5e-4*w_020302+.5+"em").attr("x",w_020302-180).attr("y",function(t,e){return 20*e+12}).text(function(t){return t.name}),svg_020302.append("g").attr("class","x axis").attr("transform","translate(0, "+h_020302+")").call(xAxis_020302).selectAll(".tick text").attr("font-size",5e-4*w_020302+.5+"em"),svg_020302.append("g").attr("class","y axis").call(yAxis_020302).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("fill","black").text("Árváltozás aránya 2010-hez képest"),svg_020302.selectAll(".y.axis text").attr("font-size",5e-4*w_020302+.5+"em"),(r=svg_020302.selectAll(".category").data(e).enter().append("g").attr("class","category")).append("path").attr("class","line").attr("d",function(t){return line_020302(t.values)}).style("stroke",function(t){return color_020302(t.name)}),(s=svg_020302.append("g").attr("class","mouse-over-effects")).append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0"),c=document.getElementsByClassName("line"),(o=s.selectAll(".mouse-per-line").data(e).enter().append("g").attr("class","mouse-per-line")).append("circle").attr("r",7).style("stroke",function(t){return color_020302(t.name)}).style("fill","none").style("stroke-width","1px").style("opacity","0"),o.append("text").attr("transform","translate(10, 3)").attr("font-size",5e-4*w_020302+.5+"em"),s.append("rect").attr("width",w_020302).attr("height",h_020302).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){d3.select(".mouse-line").style("opacity","0"),d3.selectAll(".mouse-per-line circle").style("opacity","0"),d3.selectAll(".mouse-per-line text").style("opacity","0")}).on("mouseover",function(){d3.select(".mouse-line").style("opacity","1"),d3.selectAll(".mouse-per-line circle").style("opacity","1"),d3.selectAll(".mouse-per-line text").style("opacity","1")}).on("mousemove",function(){var l,i=d3.mouse(this);console.log("Mouse:",i),d3.select(".mouse-line").attr("d",function(){var t="M"+i[0]+", "+h_020302;return t+=" "+i[0]+", 0"}),l=[],d3.selectAll(".mouse-per-line").attr("transform",function(t,e){var a,n,r,s,o;for(console.log(w_020302/i[0]),a=scaleX_020302.invert(i[0]),n=d3.bisector(function(t){return t.date}).right,idx_020302=n(t.values,a),console.log("xDate:",a),console.log("bisect",n),console.log("idx:",idx_020302),r=0,s=c[e].getTotalLength(),o=null,console.log("end",s);o=Math.floor((r+s)/2),console.log("Target:",o),pos_020302=c[e].getPointAtLength(o),console.log("Position",pos_020302.y),console.log("What is the position here:",pos_020302),o!==s&&o!==r||pos_020302.x===i[0];)if(pos_020302.x>i[0])s=o;else{if(!(pos_020302.x<i[0]))break;r=o}return d3.select(this).select("text").text(scaleY_020302.invert(pos_020302.y).toFixed(3)),l.push({ind:e,y:pos_020302.y,off:0}),"translate("+i[0]+", "+pos_020302.y+")"}).call(function(t){l.sort(function(t,e){return t.y-e.y}),l.forEach(function(t,e){if(0<e){var a=l[e-1].y;l[e].off=Math.max(0,a+15-l[e].y),l[e].y+=l[e].off}}),l.sort(function(t,e){return t.ind-e.ind})}).select("text").attr("transform",function(t,e){return"translate (10, "+(3+l[e].off)+")"})})});
