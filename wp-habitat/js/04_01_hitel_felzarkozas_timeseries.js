var margin_0401={top:50,right:50,bottom:50,left:60},w_0401=d3.select("#topic04-vis01").node().getBoundingClientRect().width-margin_0401.left-margin_0401.right,h_0401=d3.select("#topic04-vis01").node().getBoundingClientRect().height-margin_0401.top-margin_0401.bottom,parseDate_0401=d3.timeParse("%Y%m%d"),scaleX_0401=d3.scaleTime().range([0,w_0401]),scaleY_0401=d3.scaleLinear().range([h_0401,0]),color_0401=d3.scaleOrdinal().range(["#385988","#43B02A","#FF671F","#A4343A"]),xAxis_0401=d3.axisBottom().scale(scaleX_0401),yAxis_0401=d3.axisLeft().scale(scaleY_0401),line_0401=d3.line().x(function(t){return scaleX_0401(t.date)}).y(function(t){return scaleY_0401(t.ydata)}),svg_0401=d3.select("#topic04-vis01").append("svg").attr("width",w_0401+margin_0401.left+margin_0401.right).attr("height",h_0401+margin_0401.top+margin_0401.bottom).append("g").attr("transform","translate("+margin_0401.left+", "+margin_0401.top+")");function type_0401(t,e,a){t.date=parseDate_0401(t.date);for(var n=1,o=a.length,s;n<o;++n)t[s=a[n]]=+t[s];return t}d3.tsv("/wp-habitat/data/04_eladosodas/04_01_hitel_felzarkozas.tsv",type_0401,function(t,a){var e,n,o,s,c,r;if(t)throw t;e=a.columns.slice(1).map(function(e){return{name:e,values:a.map(function(t){return{date:t.date,ydata:t[e]}})}}),scaleX_0401.domain(d3.extent(a,function(t){return t.date})),scaleY_0401.domain([0,d3.max(e,function(t){return d3.max(t.values,function(t){return 1.15*t.ydata})})]),console.log("categories_0401",e),(n=svg_0401.selectAll("g").data(e).enter().append("g").attr("class","legend")).append("rect").attr("x",w_0401-130).attr("y",function(t,e){return 20*e}).attr("width",2).attr("height",15).style("fill",function(t){return color_0401(t.name)}),n.append("text").attr("font-size",5e-4*w_0401+.5+"em").attr("x",w_0401-125).attr("y",function(t,e){return 20*e+12}).text(function(t){return t.name}),svg_0401.append("g").attr("class","x axis").attr("transform","translate(0, "+h_0401+")").call(xAxis_0401).selectAll(".tick text").attr("font-size",5e-4*w_0401+.5+"em"),svg_0401.append("g").attr("class","y axis").call(yAxis_0401).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("fill","black").text("%"),svg_0401.selectAll(".y.axis text").attr("font-size",5e-4*w_0401+.5+"em"),svg_0401.append("text").attr("x",w_0401/2).attr("y",h_0401+40).style("text-anchor","middle").attr("font-size",5e-4*w_0401+.3+"em").text("ForrÃ¡s: MNB"),(o=svg_0401.selectAll(".category").data(e).enter().append("g").attr("class","category")).append("path").attr("class","line").attr("d",function(t){return line_0401(t.values)}).style("stroke",function(t){return color_0401(t.name)}),(s=svg_0401.append("g").attr("class","mouse-over-effects")).append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0"),c=document.getElementsByClassName("line"),(r=s.selectAll(".mouse-per-line").data(e).enter().append("g").attr("class","mouse-per-line")).append("circle").attr("r",7).style("stroke",function(t){return color_0401(t.name)}).style("fill","none").style("stroke-width","1px").style("opacity","0"),r.append("text").attr("transform","translate(10, 3)").attr("font-size",5e-4*w_0401+.5+"em"),s.append("rect").attr("width",w_0401).attr("height",h_0401).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){d3.select(".mouse-line").style("opacity","0"),d3.selectAll(".mouse-per-line circle").style("opacity","0"),d3.selectAll(".mouse-per-line text").style("opacity","0")}).on("mouseover",function(){d3.select(".mouse-line").style("opacity","1"),d3.selectAll(".mouse-per-line circle").style("opacity","1"),d3.selectAll(".mouse-per-line text").style("opacity","1")}).on("mousemove",function(){var l,i=d3.mouse(this);console.log("Mouse:",i),d3.select(".mouse-line").attr("d",function(){var t="M"+i[0]+", "+h_0401;return t+=" "+i[0]+", 0"}),l=[],d3.selectAll(".mouse-per-line").attr("transform",function(t,e){var a,n,o,s,r;for(console.log(w_0401/i[0]),a=scaleX_0401.invert(i[0]),n=d3.bisector(function(t){return t.date}).right,idx_0401=n(t.values,a),console.log("xDate:",a),console.log("bisect",n),console.log("idx:",idx_0401),o=0,s=c[e].getTotalLength(),r=null,console.log("end",s);r=Math.floor((o+s)/2),console.log("Target:",r),pos_0401=c[e].getPointAtLength(r),console.log("Position",pos_0401.y),console.log("What is the position here:",pos_0401),r!==s&&r!==o||pos_0401.x===i[0];)if(pos_0401.x>i[0])s=r;else{if(!(pos_0401.x<i[0]))break;o=r}return d3.select(this).select("text").text(scaleY_0401.invert(pos_0401.y).toFixed(3)),l.push({ind:e,y:pos_0401.y,off:0}),"translate("+i[0]+", "+pos_0401.y+")"}).call(function(t){l.sort(function(t,e){return t.y-e.y}),l.forEach(function(t,e){if(0<e){var a=l[e-1].y;l[e].off=Math.max(0,a+15-l[e].y),l[e].y+=l[e].off}}),l.sort(function(t,e){return t.ind-e.ind})}).select("text").attr("transform",function(t,e){return"translate (10, "+(3+l[e].off)+")"})})});
