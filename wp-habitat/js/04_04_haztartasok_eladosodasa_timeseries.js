var margin_0404={top:50,right:50,bottom:80,left:60},w_0404=d3.select("#topic04-vis04").node().getBoundingClientRect().width-margin_0404.left-margin_0404.right,h_0404=d3.select("#topic04-vis04").node().getBoundingClientRect().height-margin_0404.top-margin_0404.bottom,parseDate_0404=d3.timeParse("%Y%m%d"),scaleX_0404=d3.scaleTime().range([0,w_0404]),scaleY_0404=d3.scaleLinear().range([h_0404,0]),color_0404=d3.scaleOrdinal().range(["#385988","#43B02A","#FF671F","#A4343A"]),xAxis_0404=d3.axisBottom().scale(scaleX_0404),yAxis_0404=d3.axisLeft().scale(scaleY_0404),line_0404=d3.line().x(function(t){return scaleX_0404(t.date)}).y(function(t){return scaleY_0404(t.ydata)}),svg_0404=d3.select("#topic04-vis04").append("svg").attr("width",w_0404+margin_0404.left+margin_0404.right).attr("height",h_0404+margin_0404.top+margin_0404.bottom).append("g").attr("transform","translate("+margin_0404.left+", "+margin_0404.top+")");function type_0404(t,e,a){t.date=parseDate_0404(t.date);for(var s=1,r=a.length,n;s<r;++s)t[n=a[s]]=+t[n];return t}d3.tsv("/wp-habitat/data/04_eladosodas/04_04_haztartasok_eladosodasa.tsv",type_0404,function(t,a){var e,s,r,n,c,l;if(t)throw t;e=a.columns.slice(1).map(function(e){return{name:e,values:a.map(function(t){return{date:t.date,ydata:t[e]}})}}),scaleX_0404.domain(d3.extent(a,function(t){return t.date})),scaleY_0404.domain([0,d3.max(e,function(t){return d3.max(t.values,function(t){return 1.3*t.ydata})})]),console.log("categories_0404",e),(s=svg_0404.selectAll("g").data(e).enter().append("g").attr("class","legend")).append("rect").attr("x",w_0404-200).attr("y",function(t,e){return 20*e}).attr("width",2).attr("height",15).style("fill",function(t){return color_0404(t.name)}),s.append("text").attr("font-size",5e-4*w_0404+.5+"em").attr("x",w_0404-195).attr("y",function(t,e){return 20*e+12}).text(function(t){return t.name}),svg_0404.append("g").attr("class","x axis").attr("transform","translate(0, "+h_0404+")").call(xAxis_0404).selectAll(".tick text").attr("font-size",5e-4*w_0404+.5+"em"),svg_0404.append("g").attr("class","y axis").call(yAxis_0404).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("fill","black").text("Milliárd forint"),svg_0404.selectAll(".y.axis text").attr("font-size",5e-4*w_0404+.5+"em"),svg_0404.append("text").attr("x",w_0404).attr("y",h_0404+60).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.3+"em").text("Forrás: MNB"),svg_0404.append("line").attr("class","event").attr("x1",scaleX_0404(parseDate_0404("20040401"))).attr("y1",0).attr("x2",scaleX_0404(parseDate_0404("20040401"))).attr("y2",h_0404+50).style("stroke-width",1).style("stroke","red").style("fill","none").style("stroke-dasharray","3, 3"),svg_0404.append("text").attr("class","event text").attr("x",scaleX_0404(parseDate_0404("20040401"))).attr("y",h_0404+60).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.4+"em").text("EU-csatlakozás"),svg_0404.append("line").attr("class","event").attr("x1",scaleX_0404(parseDate_0404("20081001"))).attr("y1",0).attr("x2",scaleX_0404(parseDate_0404("20081001"))).attr("y2",h_0404+50).style("stroke-width",1).style("stroke","red").style("fill","none").style("stroke-dasharray","3, 3"),svg_0404.append("text").attr("class","event text").attr("x",scaleX_0404(parseDate_0404("20081001"))).attr("y",h_0404+60).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.4+"em").text("Gazdasági válság"),svg_0404.append("text").attr("class","event text").attr("x",scaleX_0404(parseDate_0404("20081001"))).attr("y",h_0404+75).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.4+"em").text("kezdete"),svg_0404.append("line").attr("class","event").attr("x1",scaleX_0404(parseDate_0404("20111001"))).attr("y1",0).attr("x2",scaleX_0404(parseDate_0404("20111001"))).attr("y2",h_0404+50).style("stroke-width",1).style("stroke","red").style("fill","none").style("stroke-dasharray","3, 3"),svg_0404.append("text").attr("class","event text").attr("x",scaleX_0404(parseDate_0404("20111001"))).attr("y",h_0404+60).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.4+"em").text("Végtörlesztés:"),svg_0404.append("text").attr("class","event text").attr("x",scaleX_0404(parseDate_0404("20111001"))).attr("y",h_0404+75).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.4+"em").text("180 forint/frank"),svg_0404.append("line").attr("class","event").attr("x1",scaleX_0404(parseDate_0404("20141001"))).attr("y1",0).attr("x2",scaleX_0404(parseDate_0404("20141001"))).attr("y2",h_0404+50).style("stroke-width",1).style("stroke","red").style("fill","none").style("stroke-dasharray","3, 3"),svg_0404.append("text").attr("class","event text").attr("x",scaleX_0404(parseDate_0404("20141001"))).attr("y",h_0404+60).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.4+"em").text("Forintosítás:"),svg_0404.append("text").attr("class","event text").attr("x",scaleX_0404(parseDate_0404("20141001"))).attr("y",h_0404+75).style("text-anchor","middle").attr("font-size",5e-4*w_0404+.4+"em").text("256,5 forint/frank"),(r=svg_0404.selectAll(".category").data(e).enter().append("g").attr("class","category")).append("path").attr("class","line").attr("d",function(t){return line_0404(t.values)}).style("stroke",function(t){return color_0404(t.name)}),(n=svg_0404.append("g").attr("class","mouse-over-effects")).append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0"),c=document.getElementsByClassName("line"),(l=n.selectAll(".mouse-per-line").data(e).enter().append("g").attr("class","mouse-per-line")).append("circle").attr("r",7).style("stroke",function(t){return color_0404(t.name)}).style("fill","none").style("stroke-width","1px").style("opacity","0"),l.append("text").attr("transform","translate(10, 3)").attr("font-size",5e-4*w_0404+.5+"em"),n.append("rect").attr("width",w_0404).attr("height",h_0404).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){d3.select(".mouse-line").style("opacity","0"),d3.selectAll(".mouse-per-line circle").style("opacity","0"),d3.selectAll(".mouse-per-line text").style("opacity","0")}).on("mouseover",function(){d3.select(".mouse-line").style("opacity","1"),d3.selectAll(".mouse-per-line circle").style("opacity","1"),d3.selectAll(".mouse-per-line text").style("opacity","1")}).on("mousemove",function(){var o,i=d3.mouse(this);console.log("Mouse:",i),d3.select(".mouse-line").attr("d",function(){var t="M"+i[0]+", "+h_0404;return t+=" "+i[0]+", 0"}),o=[],d3.selectAll(".mouse-per-line").attr("transform",function(t,e){var a,s,r,n,l;for(console.log(w_0404/i[0]),a=scaleX_0404.invert(i[0]),s=d3.bisector(function(t){return t.date}).right,idx_0404=s(t.values,a),console.log("xDate:",a),console.log("bisect",s),console.log("idx:",idx_0404),r=0,n=c[e].getTotalLength(),l=null,console.log("end",n);l=Math.floor((r+n)/2),console.log("Target:",l),pos_0404=c[e].getPointAtLength(l),console.log("Position",pos_0404.y),console.log("What is the position here:",pos_0404),l!==n&&l!==r||pos_0404.x===i[0];)if(pos_0404.x>i[0])n=l;else{if(!(pos_0404.x<i[0]))break;r=l}return d3.select(this).select("text").text(scaleY_0404.invert(pos_0404.y).toFixed(3)),o.push({ind:e,y:pos_0404.y,off:0}),"translate("+i[0]+", "+pos_0404.y+")"}).call(function(t){o.sort(function(t,e){return t.y-e.y}),o.forEach(function(t,e){if(0<e){var a=o[e-1].y;o[e].off=Math.max(0,a+15-o[e].y),o[e].y+=o[e].off}}),o.sort(function(t,e){return t.ind-e.ind})}).select("text").attr("transform",function(t,e){return"translate (10, "+(3+o[e].off)+")"})})});
