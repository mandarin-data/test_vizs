var margin_0501={top:50,right:50,bottom:50,left:60},w_0501=d3.select("#topic05-vis01").node().getBoundingClientRect().width-margin_0501.left-margin_0501.right,h_0501=d3.select("#topic05-vis01").node().getBoundingClientRect().height-margin_0501.top-margin_0501.bottom,parseDate_0501=d3.timeParse("%Y%m%d"),scaleX_0501=d3.scaleTime().range([0,w_0501]),scaleY_0501=d3.scaleLinear().range([h_0501,0]),color_0501=d3.scaleOrdinal().range(["#385988","#43B02A","#FF671F","#A4343A"]),xAxis_0501=d3.axisBottom().scale(scaleX_0501),yAxis_0501=d3.axisLeft().scale(scaleY_0501),line_0501=d3.line().x(function(t){return scaleX_0501(t.date)}).y(function(t){return scaleY_0501(t.ydata)}),svg_0501=d3.select("#topic05-vis01").append("svg").attr("width",w_0501+margin_0501.left+margin_0501.right).attr("height",h_0501+margin_0501.top+margin_0501.bottom).append("g").attr("transform","translate("+margin_0501.left+", "+margin_0501.top+")");function type_0501(t,e,n){t.date=parseDate_0501(t.date);for(var a=1,s=n.length,o;a<s;++a)t[o=n[a]]=+t[o];return t}d3.tsv("/wp-habitat/data/05_alberlet_also_szegmense/05_01_jovedelem_vs_alberletar_novekedes.tsv",type_0501,function(t,n){var e,a,s,o,c,r;if(t)throw t;e=n.columns.slice(1).map(function(e){return{name:e,values:n.map(function(t){return{date:t.date,ydata:t[e]}})}}),scaleX_0501.domain(d3.extent(n,function(t){return t.date})),scaleY_0501.domain([d3.min(e,function(t){return d3.min(t.values,function(t){return 1.15*t.ydata})}),d3.max(e,function(t){return d3.max(t.values,function(t){return 1.15*t.ydata})})]),console.log("categories_0501",e),(a=svg_0501.selectAll("g").data(e).enter().append("g").attr("class","legend")).append("rect").attr("x",w_0501-200).attr("y",function(t,e){return 20*e}).attr("width",2).attr("height",15).style("fill",function(t){return color_0501(t.name)}),a.append("text").attr("font-size",5e-4*w_0501+.5+"em").attr("x",w_0501-195).attr("y",function(t,e){return 20*e+12}).text(function(t){return t.name}),svg_0501.append("g").attr("class","x axis").attr("transform","translate(0, "+h_0501+")").call(xAxis_0501).selectAll(".tick text").attr("font-size",5e-4*w_0501+.5+"em"),svg_0501.append("g").attr("class","y axis").call(yAxis_0501).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").style("fill","black").text("Változás aránya 2010-hez képest"),svg_0501.selectAll(".y.axis text").attr("font-size",5e-4*w_0501+.5+"em"),(s=svg_0501.selectAll(".category").data(e).enter().append("g").attr("class","category")).append("path").attr("class","line").attr("d",function(t){return line_0501(t.values)}).style("stroke",function(t){return color_0501(t.name)}),(o=svg_0501.append("g").attr("class","mouse-over-effects")).append("path").attr("class","mouse-line").style("stroke","black").style("stroke-width","1px").style("opacity","0"),c=document.getElementsByClassName("line"),(r=o.selectAll(".mouse-per-line").data(e).enter().append("g").attr("class","mouse-per-line")).append("circle").attr("r",7).style("stroke",function(t){return color_0501(t.name)}).style("fill","none").style("stroke-width","1px").style("opacity","0"),r.append("text").attr("transform","translate(10, 3)").attr("font-size",5e-4*w_0501+.5+"em"),o.append("rect").attr("width",w_0501).attr("height",h_0501).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){d3.select(".mouse-line").style("opacity","0"),d3.selectAll(".mouse-per-line circle").style("opacity","0"),d3.selectAll(".mouse-per-line text").style("opacity","0")}).on("mouseover",function(){d3.select(".mouse-line").style("opacity","1"),d3.selectAll(".mouse-per-line circle").style("opacity","1"),d3.selectAll(".mouse-per-line text").style("opacity","1")}).on("mousemove",function(){var l,i=d3.mouse(this);console.log("Mouse:",i),d3.select(".mouse-line").attr("d",function(){var t="M"+i[0]+", "+h_0501;return t+=" "+i[0]+", 0"}),l=[],d3.selectAll(".mouse-per-line").attr("transform",function(t,e){var n,a,s,o,r;for(console.log(w_0501/i[0]),n=scaleX_0501.invert(i[0]),a=d3.bisector(function(t){return t.date}).right,idx_0501=a(t.values,n),console.log("xDate:",n),console.log("bisect",a),console.log("idx:",idx_0501),s=0,o=c[e].getTotalLength(),r=null,console.log("end",o);r=Math.floor((s+o)/2),console.log("Target:",r),pos_0501=c[e].getPointAtLength(r),console.log("Position",pos_0501.y),console.log("What is the position here:",pos_0501),r!==o&&r!==s||pos_0501.x===i[0];)if(pos_0501.x>i[0])o=r;else{if(!(pos_0501.x<i[0]))break;s=r}return d3.select(this).select("text").text(scaleY_0501.invert(pos_0501.y).toFixed(3)),l.push({ind:e,y:pos_0501.y,off:0}),"translate("+i[0]+", "+pos_0501.y+")"}).call(function(t){l.sort(function(t,e){return t.y-e.y}),l.forEach(function(t,e){if(0<e){var n=l[e-1].y;l[e].off=Math.max(0,n+15-l[e].y),l[e].y+=l[e].off}}),l.sort(function(t,e){return t.ind-e.ind})}).select("text").attr("transform",function(t,e){return"translate (10, "+(3+l[e].off)+")"})})});
