var svg=d3.select("#vis-1"),margin={top:20,right:20,bottom:30,left:40},comfortWidth=+svg.node().getBoundingClientRect().width-margin.left-margin.right,comfortHeight=+svg.attr("height")-margin.top-margin.bottom,g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),comfortX=d3.scaleBand().rangeRound([0,comfortWidth]).paddingInner(.05).align(.1),y=d3.scaleLinear().rangeRound([comfortHeight,0]),z=d3.scaleOrdinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b"]);d3.csv("/wp-habitat/data/02_lakasminoseg_energiaszegenyseg/02_01_komfort.csv",function(a,r,n){for(r=1,t=0;r<n.length;++r)t+=a[n[r]]=+a[n[r]];return a.total=t,a},function(t,a){var r,n;if(t)throw t;r=a.columns.slice(1),a.sort(function(t,a){return a.total-t.total}),comfortX.domain(a.map(function(t){return t.Régió})),y.domain([0,d3.max(a,function(t){return t.total})]).nice(),z.domain(r),g.append("g").selectAll("g").data(d3.stack().keys(r)(a)).enter().append("g").attr("fill",function(t){return z(t.key)}).selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return comfortX(t.data.Régió)}).attr("y",function(t){return y(t[1])}).attr("height",function(t){return y(t[0])-y(t[1])}).attr("width",comfortX.bandwidth()),g.append("g").attr("class","axis").attr("transform","translate(0,"+comfortHeight+")").call(d3.axisBottom(comfortX)),g.append("g").attr("class","axis").call(d3.axisLeft(y).ticks(null,"s")).append("text").attr("x",2).attr("y",y(y.ticks().pop())+.5).attr("dy","0.32em").attr("fill","#000").attr("font-weight","bold").attr("text-anchor","start").text("%"),(n=g.append("g").attr("font-family","sans-serif").attr("font-size",10).attr("text-anchor","end").selectAll("g").data(r.slice().reverse()).enter().append("g").attr("transform",function(t,a){return"translate(0,"+20*a+")"})).append("rect").attr("x",comfortWidth-19).attr("width",19).attr("height",19).attr("fill",z),n.append("text").attr("x",comfortWidth-24).attr("y",9.5).attr("dy","0.32em").text(function(t){return t})});