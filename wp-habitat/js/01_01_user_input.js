var margin={top:20,right:40,bottom:20,left:40},userInputWidth=d3.select("#viscontainer-0101").node().getBoundingClientRect().width-margin.left-margin.right,userInputHeight=450-margin.top-margin.bottom,x=d3.scaleBand().rangeRound([0,userInputWidth],.1).paddingInner(.1),y=d3.scaleLinear().range([userInputHeight,0]),xAxisUserInput=d3.axisBottom().scale(x),yAxis=d3.axisLeft().scale(y).ticks(10),svg=d3.select("#vis-0101").append("svg").attr("width",userInputWidth+margin.left+margin.right).attr("height",userInputHeight+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),tooltip=d3.select("#vis-0101").append("div").attr("class","toolTip").style("visibility","hidden");function myFunction(){var s=document.getElementById("myForm").elements[0].value,t=document.getElementById("myForm").elements[1].value,l=t/s*100;d3.tsv("/wp-habitat/js/01_01_user_input.tsv",function(t,e){var n,r,a,i;if(t)throw t;n=e.filter(function(t){return t.Dec_f=+t.Dec_f,t.Dec_a=+t.Dec_a,s<=t.Dec_f&&t.Dec_a<=s}),r=n.filter(function(t){return t.Decilis})[0].Decilis,a=n.filter(function(t){return t.Decilis})[0].Percent,i=l-a,x.domain(e.map(function(t){return t.Decilis})),y.domain([0,100]),svg.selectAll("text.label").remove(),svg.selectAll("text.label1").remove(),svg.selectAll("text.label2").remove(),svg.selectAll("line.arrow").remove(),svg.selectAll("g").remove(),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+userInputHeight+")").call(xAxisUserInput),svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Percent"),svg.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(t){return x(t.Decilis)}).attr("y",function(t){return y(t.Percent)}).attr("width",x.bandwidth()).attr("height",function(t){return userInputHeight-y(t.Percent)}).on("mousemove",function(t){tooltip.style("visibility","visible").style("left",d3.event.pageX-50+"px").style("top",d3.event.pageY-70+"px").style("display","inline-block").html(t.Decilis+". decilis : "+t.Percent+"%")}).on("mouseout",function(t){tooltip.style("display","none")}),svg.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",8).attr("markerWidth",7).attr("markerHeight",7).attr("orient","auto").append("path").attr("class","marker").attr("d","M0,-5L10,0L0,5"),svg.selectAll("text.label").data(e.filter(function(t){return 2==t.Decilis})).enter().append("text").attr("class","label").attr("x",function(t){return userInputWidth/2}).attr("y",function(t){return 10}).style("text-anchor","middle").style("font-size","14px").text("A "+r+". jövedelmi decilisbe tartozik,"),svg.selectAll("text.label1").data(e.filter(function(t){return 2==t.Decilis})).enter().append("text").attr("class","label").attr("x",function(t){return userInputWidth/2}).attr("y",function(t){return 25}).style("text-anchor","middle").style("font-size","14px").text(function(t){return"melynek átlagához képest "+Math.round(Math.abs(i))+" százalékkal"}),svg.selectAll("text.label2").data(e.filter(function(t){return 2==t.Decilis})).enter().append("text").attr("class","label").attr("x",function(t){return userInputWidth/2}).attr("y",function(t){return 40}).style("text-anchor","middle").style("font-size","14px").text(function(t){return i<0?"költ kevesebbet lahatásra":"költ többet lahatásra"}),svg.selectAll("line.arrow").data(e.filter(function(t){return 2==t.Decilis})).enter().append("line").attr("class","arrow").attr("x1",function(t){return r<4?userInputWidth/2-60:6<r?userInputWidth/2+60:userInputWidth/2}).attr("x2",function(t){return(x(t.Decilis)-4)/2*1+(x(t.Decilis)-4)*(r-1)}).attr("y1",function(t){return 65}).attr("y2",function(t){return userInputHeight*((100-a)/100)-25}).attr("marker-end","url(#arrow)")})}function type(t){return t.Percent=+t.Percent,t}d3.tsv("/wp-habitat/data/01_hozzaferhetoseg_es_megfizethetoseg/01_01_user_input.tsv",function(t,e){x.domain(e.map(function(t){return t.Decilis})),y.domain([0,100]),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+userInputHeight+")").call(xAxisUserInput),svg.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Percent"),svg.selectAll(".bar").data(e).enter().append("rect").attr("class","bar").attr("x",function(t){return x(t.Decilis)}).attr("y",function(t){return y(t.Percent)}).attr("width",x.bandwidth()).attr("height",function(t){return userInputHeight-y(t.Percent)}).on("mousemove",function(t){tooltip.style("visibility","visible").style("left",d3.event.pageX-50+"px").style("top",d3.event.pageY-70+"px").style("display","inline-block").html(t.Decilis+". decilis : "+t.Percent+"%")}).on("mouseout",function(t){tooltip.style("display","none")})});