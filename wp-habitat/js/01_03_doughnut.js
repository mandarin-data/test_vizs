var doughnutWidth,doughnutHeight,radius,color,svgdoughnut,donutWidth,arc,chartTooltip=d3.select("#chart-doughnut").append("div").attr("class","tooltip");chartTooltip.append("div").attr("class","label"),chartTooltip.append("div").attr("class","percent"),d3.csv("/wp-habitat/data/01_hozzaferhetoseg_es_megfizethetoseg/01_03_doughnut.tsv",function(t,r){var o,d,l,u,e;r.forEach(function(t){t.percent=+t.percent,t.enabled=!0}),o=d3.pie().value(function(t){return t.percent}).sort(null),d=svgdoughnut.selectAll("path").data(o(r)).enter().append("path").attr("d",arc).attr("fill",function(t,e){return color(t.data.label)}).each(function(t){this._current=t}),l=18,u=4,(e=svgdoughnut.selectAll(".legend").data(color.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){var a=l+u,n=a*color.domain().length/2,r=-2*l,o=e*a-n;return"translate("+r+","+o+")"})).append("rect").attr("width",l).attr("height",l).style("fill",color).style("stroke",color).on("click",function(e){var t=d3.select(this),a=!0,n=d3.sum(r.map(function(t){return t.enabled?1:0}));if("disabled"===t.attr("class"))t.attr("class","");else{if(n<2)return;t.attr("class","disabled"),a=!1}o.value(function(t){return t.label===e&&(t.enabled=a),t.enabled?t.percent:0}),(d=d.data(o(r))).transition().duration(750).attrTween("d",function(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return arc(e(t))}})}),e.append("text").attr("x",l+u).attr("y",l-u).text(function(t){return t}),d.on("mouseover",function(t){chartTooltip.select(".label").html(t.data.label),chartTooltip.select(".percent").html(parseFloat(100*t.data.percent).toFixed(1)+"%"),chartTooltip.style("display","block")}),d.on("mouseout",function(){chartTooltip.style("display","none")}),d.on("mousemove",function(t){chartTooltip.style("top",d3.event.pageY+10+"px").style("left",d3.event.pageX+10+"px")})}),doughnutHeight=doughnutWidth=360,radius=Math.min(doughnutWidth,doughnutHeight)/2,color=d3.scaleOrdinal(d3.schemeCategory20b),svgdoughnut=d3.select("#chart-doughnut").append("svg").attr("width",doughnutWidth).attr("height",doughnutHeight).append("g").attr("transform","translate("+doughnutWidth/2+","+doughnutHeight/2+")"),donutWidth=75,arc=d3.arc().innerRadius(radius-donutWidth).outerRadius(radius);