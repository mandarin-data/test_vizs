var margin,userInputWidth,userInputHeight,doughnutWidth,doughnutHeight,radius_doughnut,color_doughnut,svgdoughnut,donutWidth,arc_doughnut,chartTooltip_doughnut=d3.select("#chart-doughnut").append("div").style("display","none").attr("id","d_tooltip");chartTooltip_doughnut.append("div").attr("id","d_label"),chartTooltip_doughnut.append("div").attr("id","d_percent"),d3.csv("/wp-habitat/data/01_hozzaferhetoseg_es_megfizethetoseg/01_03_doughnut.tsv",function(t,u){var d,r,a,i,e;u.forEach(function(t){t.percent=+t.percent,t.enabled=!0}),d=d3.pie().value(function(t){return t.percent}).sort(null),r=svgdoughnut.selectAll("path").data(d(u)).enter().append("path").attr("d",arc_doughnut).attr("fill",function(t,e){return color_doughnut(t.data.label)}).each(function(t){this._current=t}),a=doughnutWidth/30,i=4,(e=svgdoughnut.selectAll(".legend").data(color_doughnut.domain()).enter().append("g").attr("class","legend").attr("transform",function(t,e){var n=a+i,o=n*color_doughnut.domain().length/2,u=-5*a,d=e*n-o;return"translate("+u+","+d+")"})).append("rect").attr("class","d_rect").attr("width",a).attr("height",a).style("fill",color_doughnut).style("stroke",color_doughnut).style("stroke-width",2).style("cursor","pointer").on("click",function(e){var t=d3.select(this),n=!0,o=d3.sum(u.map(function(t){return t.enabled?1:0}));if("disabled"===t.attr("class"))t.attr("class","");else{if(o<2)return;t.attr("class","disabled"),n=!1}d.value(function(t){return t.label===e&&(t.enabled=n),t.enabled?t.percent:0}),(r=r.data(d(u))).transition().duration(750).attrTween("d",function(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return arc_doughnut(e(t))}})}),e.append("text").attr("x",a+i).attr("y",a-i).style("font-size",doughnutWidth/30).text(function(t){return t}),r.on("mouseover",function(t){chartTooltip_doughnut.select("#d_label").html(t.data.label),chartTooltip_doughnut.select("#d_percent").html(parseFloat(100*t.data.percent).toFixed(1)+"%"),chartTooltip_doughnut.style("display","inline")}),r.on("mouseout",function(){chartTooltip_doughnut.style("display","none")}),r.on("mousemove",function(t){chartTooltip_doughnut.style("left",d3.mouse(this)[0]+d3.select("#chart-doughnut").node().getBoundingClientRect().width/2-30+"px").style("top",d3.mouse(this)[1]+195+"px")})}),margin={top:50,right:100,bottom:50,left:100},userInputWidth=d3.select("#chart-doughnut").node().getBoundingClientRect().width-margin.left-margin.right,userInputHeight=d3.select("#chart-doughnut").node().getBoundingClientRect().width-margin.top-margin.bottom,doughnutWidth=userInputWidth,doughnutHeight=userInputHeight,radius_doughnut=Math.min(doughnutWidth,doughnutHeight)/2,color_doughnut=d3.scaleOrdinal(["#385988","#43B02A","#FF671F","#A4343A"]),(svgdoughnut=d3.select("#chart-doughnut").append("svg").attr("width",doughnutWidth).attr("height",doughnutHeight).append("g").attr("transform","translate("+doughnutWidth/2+","+doughnutHeight/2+")")).append("text").attr("id","doughnut_title").attr("x",0).attr("y",-doughnutHeight/2+margin.top/2).attr("text-anchor","middle").style("font-size",doughnutWidth/27).text("A lakott lakások megoszlása használati jogcím szerint (2016)"),svgdoughnut.append("text").attr("id","doughnut_forras").attr("x",0).attr("y",+doughnutHeight/2-margin.bottom/2).attr("text-anchor","middle").style("font-size",doughnutWidth/30).text("Adatok forrása: KSH 2018a").on("click",function(t){window.open("https://www.ksh.hu/mikrocenzus2016/docs/tablak/07/07_2_2.xls","_blank")}).on("mouseover",function(t){d3.select(this).style("cursor","pointer")}).on("mouseout",function(){d3.select(this).style("cursor","default")}).on("mousemove",function(t){d3.select(this).style("cursor","pointer")}),svgdoughnut.append("text").attr("id","doughnut_labjegyzet").attr("x",0).attr("y",+doughnutHeight/2-margin.bottom/10).attr("text-anchor","middle").style("font-size",doughnutWidth/30).text("A legend-re kattintva szűrhet!"),donutWidth=userInputWidth/5,arc_doughnut=d3.arc().innerRadius(radius_doughnut-donutWidth).outerRadius(radius_doughnut);
