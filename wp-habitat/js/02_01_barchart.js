function BarChart(){function t(t){t.each(function(t,e){var r,n,a,s,i,l,o,c,d,u,p,y,h,f,g,_,m,x,k,b,v,w,A,R;function F(t){d3.selectAll(".bars:not(.class"+class_keep+")").transition().duration(1e3).delay(function(){return x?1300:0}).attr("width",o.bandwidth()).style("opacity",1),d3.selectAll(".class"+class_keep).attr("x",function(t){return o(t.myregion_11)}).transition().duration(1e3).delay(function(){return x?1300:0}).attr("y",function(t){return c(t.y1_11)}),x=!1}function B(t){var e;class_keep=t.id.split("id").pop(),idx=g.indexOf(class_keep),d3.selectAll(".bars:not(.class"+class_keep+")").transition().duration(1e3).attr("width",0).style("opacity",0),d3.selectAll(".g").nodes().forEach(function(t,e){var r=t.childNodes;h_keep=d3.select(r[idx]).attr("height"),y_keep=d3.select(r[idx]).attr("y"),h_base=d3.select(r[0]).attr("height"),y_base=d3.select(r[0]).attr("y"),h_shift=h_keep-h_base,y_new=y_base-h_shift,d3.select(r[idx]).attr("y",y_new)})}function N(){var r,t,e;v.sort(function(t,e){return d3.ascending(t.Régió,e.Régió)}),m=!!this.checked,colName=_[sortBy],r=o.domain(v.sort(m?function(t,e){return e[colName]-t[colName]}:function(t,e){return e.total-t.total}).map(function(t,e){return t.Régió})).copy(),w.selectAll(".class"+h).sort(function(t,e){return r(t.myregion_11)-r(e.myregion_11)}),e=function(t,e){return 20*e},(t=y.transition().duration(750)).selectAll(".class"+h).delay(e).attr("x",function(t){return r(t.myregion_11)}),t.select(".x.axis").call(u).selectAll("g").delay(e),t.select(".axis_0201").call(u).selectAll("g").delay(e)}d3.select("#vis-11").remove(),r=20,n=0,a=45,s=40,i=d3.select("#viscontainer-11").node().getBoundingClientRect().width-s-n,l=450-r-a,o=d3.scaleBand().rangeRound([0,i-230]).paddingInner(.05).align(.8),c=d3.scaleLinear().rangeRound([l,0]),d=d3.scaleOrdinal().range(["#385988","#43B02A","#FF671F","#A4343A"]),u=d3.axisBottom().scale(o),p=d3.axisLeft(c).ticks(null,"%"),y=d3.select("#viscontainer-11").append("svg").attr("width",i+s+n).attr("height",l+r+a).attr("id","vis-11").append("g").attr("transform","translate("+s+","+r+")"),h="0",g=[],x=!(_=[]),d3.select("#mycheck").property("disabled",!0).property("checked",!1),k=d3.values(t)[0],(b=Object.keys(k)).shift(),(v=t).forEach(function(t){v[b[1]]=+v[b[1]],v[b[2]]=+v[b[2]],v[b[3]]=+v[b[3]],v[b[0]]=+v[b[0]]}),d.domain(d3.keys(v[0]).filter(function(t){return"Régió"!==t})),v.forEach(function(e){var r=e.Régió,n=0;e.categories=d.domain().map(function(t){return{myregion_11:r,name:t,y0_11:n,y1_11:n+=+e[t],value:e[t],y_corrected:0}}),e.total=e.categories[e.categories.length-1].y1_11}),v.sort(function(t,e){return d3.ascending(t.Régió,e.Régió)}),v.sort(function(t,e){return e.total-t.total}),o.domain(v.map(function(t){return t.Régió})),c.domain([0,1]),y.append("g").attr("class","axis_0201").attr("transform","translate(0,"+l+")").call(u),y.append("g").attr("class","axis_0201").call(p).append("text").attr("x",2).attr("y",c(c.ticks().pop())+.5).attr("dy","0.32em").attr("fill","#000").attr("font-weight","bold").attr("text-anchor","start"),w=y.selectAll(".state").data(v).enter().append("g").attr("class","g").attr("transform",function(t){return"translate(0,0)"}),(A=y.append("g").attr("class","tooltip_0201").style("display","none")).append("rect").attr("width",60).attr("height",20).attr("fill","white").attr("stroke","#666").attr("stroke-width","0.5px"),A.append("text").attr("x",30).attr("dy","1.2em").style("text-anchor","middle").attr("font-size","12px").attr("font","sans-serif"),y.append("text").attr("class","barchart_02_01_forras").attr("x",i-230).attr("y",l+a-5).attr("text-anchor","end").text("Adatok forrása: még nem tudni").on("click",function(t){window.open("https://hu.wikipedia.org/wiki/Sablon:Nincs_forr%C3%A1s","_blank")}).on("mouseover",function(t){d3.select(this).style("cursor","pointer")}).on("mouseout",function(){d3.select(this).style("cursor","default")}).on("mousemove",function(t){d3.select(this).style("cursor","pointer")}),height_diff=0,w.selectAll("rect").data(function(t){return t.categories}).enter().append("rect").attr("width",o.bandwidth()).attr("y",function(t){return height_diff=height_diff+c(t.y0_11)-c(t.y1_11)-(c(0)-c(t.value)),y_corrected=c(t.y1_11)+height_diff,t.y_corrected=y_corrected,c(t.y1_11)}).attr("x",function(t){return o(t.myregion_11)}).attr("height",function(t){return c(t.y0_11)-c(t.y1_11)}).attr("class",function(t){return classLabel=t.name.replace(/\s+|[,]+\s/g,"").trim(),"bars class"+classLabel}).style("fill",function(t){return d(t.name)}),w.selectAll("rect").on("mouseover",function(){A.style("display",null)}).on("mouseout",function(){A.style("display","none")}).on("mousemove",function(t){var e=t.y1_11-t.y0_11,r=d3.mouse(this)[0]-40,n=d3.mouse(this)[1]-30;A.attr("transform","translate("+r+","+n+")").select("text").text((100*e).toFixed(1)+"%"),console.log(e)}),R=y.selectAll(".legend").data(d.domain().slice().reverse()).enter().append("g").attr("class",function(t){return g.push(t.replace(/\s+|[,]+\s/g,"")),_.push(t),"legend"}).attr("transform",function(t,e){return"translate(0,"+20*e+")"}),g=g.reverse(),_=_.reverse(),R.append("rect").attr("x",i-210).attr("width",18).attr("height",18).style("fill",d).attr("id",function(t,e){return"id"+t.replace(/\s+|[,]+\s/g,"")}).on("mouseover",function(){"0"===h?d3.select(this).style("cursor","pointer"):h.split("class").pop()===this.id.split("id").pop()?d3.select(this).style("cursor","pointer"):d3.select(this).style("cursor","auto")}).on("click",function(t){if("0"===h){for(d3.select(this).style("stroke","black").style("stroke-width",2),h=this.id.split("id").pop(),B(this),e=0;e<g.length;e++)g[e]!=h?d3.select("#id"+g[e]).style("opacity",.5):sortBy=e;d3.select("#mycheck").property("disabled",!1),d3.select(".barlabel").style("color","black"),d3.select(".myinput_large").style("opacity","100"),d3.select("#mycheck").on("change",N)}else if(h===this.id.split("id").pop()){for(d3.select(this).style("stroke","none"),e=0;e<g.length;e++)d3.select("#id"+g[e]).style("opacity",1);d3.select("#mycheck").property("checked")&&(x=!0),d3.select(".barlabel").style("color","#FFFFFF").select("input").property("disabled",!0).property("checked",!1),d3.select(".myinput_large").style("opacity","0").select("input").property("disabled",!0).property("checked",!1),N(),F(t),h="0"}}),R.append("text").attr("class","legend_0201").attr("x",i-175).attr("y",8).attr("dy","0.32em").attr("text-anchor","start").text(function(t){return t})})}return t}
