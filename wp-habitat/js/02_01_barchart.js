function BarChart(){function t(t){t.each(function(t,e){var n,r,a,s,i,l,c,o,d,u,p,y,f,h,g,m,x,b,_,k,v,w,A,R;function B(t){d3.selectAll(".bars:not(.class"+class_keep+")").transition().duration(1e3).delay(function(){return b?1300:0}).attr("width",c.bandwidth()).style("opacity",1),d3.selectAll(".class"+class_keep).attr("x",function(t){return c(t.myregion)}).transition().duration(1e3).delay(function(){return b?1300:0}).attr("y",function(t){return o(t.y1)}),b=!1}function L(t){var e;class_keep=t.id.split("id").pop(),idx=g.indexOf(class_keep),d3.selectAll(".bars:not(.class"+class_keep+")").transition().duration(1e3).attr("width",0).style("opacity",0),d3.selectAll(".g").nodes().forEach(function(t,e){var n=t.childNodes;h_keep=d3.select(n[idx]).attr("height"),y_keep=d3.select(n[idx]).attr("y"),h_base=d3.select(n[0]).attr("height"),y_base=d3.select(n[0]).attr("y"),h_shift=h_keep-h_base,y_new=y_base-h_shift,d3.select(n[idx]).attr("y",y_new)})}function N(){var n,t,e;v.sort(function(t,e){return d3.ascending(t.Régió,e.Régió)}),x=!!this.checked,colName=m[sortBy],n=c.domain(v.sort(x?function(t,e){return e[colName]-t[colName]}:function(t,e){return e.total-t.total}).map(function(t,e){return t.Régió})).copy(),w.selectAll(".class"+f).sort(function(t,e){return n(t.myregion)-n(e.myregion)}),e=function(t,e){return 20*e},(t=y.transition().duration(750)).selectAll(".class"+f).delay(e).attr("x",function(t){return n(t.myregion)}),t.select(".x.axis").call(u).selectAll("g").delay(e),t.select(".x.axis").call(u).selectAll("g").delay(e)}d3.select("#vis-11").remove(),r=20,a=n=30,s=40,i=d3.select("#viscontainer-11").node().getBoundingClientRect().width-s-r,l=500-n-a,c=d3.scaleBand().rangeRound([0,i-230]).paddingInner(.05).align(.8),o=d3.scaleLinear().rangeRound([l,0]),d=d3.scaleOrdinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b"]),u=d3.axisBottom().scale(c),p=d3.axisLeft(o).ticks(null,"%"),y=d3.select("#viscontainer-11").append("svg").attr("width",i+s+r).attr("height",l+n+a).attr("id","vis-11").append("g").attr("transform","translate("+s+","+n+")"),f="0",g=[],b=!(m=[]),d3.select("label").select("input").property("disabled",!0).property("checked",!1),_=d3.values(t)[0],(k=Object.keys(_)).shift(),(v=t).forEach(function(t){v[k[1]]=+v[k[1]],v[k[2]]=+v[k[2]],v[k[3]]=+v[k[3]],v[k[0]]=+v[k[0]]}),d.domain(d3.keys(v[0]).filter(function(t){return"Régió"!==t})),v.forEach(function(e){var n=e.Régió,r=0;e.categories=d.domain().map(function(t){return{myregion:n,name:t,y0:r,y1:r+=+e[t],value:e[t],y_corrected:0}}),e.total=e.categories[e.categories.length-1].y1}),v.sort(function(t,e){return d3.ascending(t.Régió,e.Régió)}),v.sort(function(t,e){return e.total-t.total}),c.domain(v.map(function(t){return t.Régió})),o.domain([0,1]),y.append("g").attr("class","x axis").attr("transform","translate(0,"+l+")").call(u),y.append("g").attr("class","y axis").call(p).append("text").attr("x",2).attr("y",o(o.ticks().pop())+.5).attr("dy","0.32em").attr("fill","#000").attr("font-weight","bold").attr("text-anchor","start"),w=y.selectAll(".state").data(v).enter().append("g").attr("class","g").attr("transform",function(t){return"translate(0,0)"}),(A=y.append("g").attr("class","tooltip").style("display","none")).append("rect").attr("width",60).attr("height",20).attr("fill","white").style("opacity",.7),A.append("text").attr("x",30).attr("dy","1.2em").style("text-anchor","middle").attr("font-size","12px").attr("font","sans-serif"),height_diff=0,w.selectAll("rect").data(function(t){return t.categories}).enter().append("rect").attr("width",c.bandwidth()).attr("y",function(t){return height_diff=height_diff+o(t.y0)-o(t.y1)-(o(0)-o(t.value)),y_corrected=o(t.y1)+height_diff,t.y_corrected=y_corrected,o(t.y1)}).attr("x",function(t){return c(t.myregion)}).attr("height",function(t){return o(t.y0)-o(t.y1)}).attr("class",function(t){return classLabel=t.name.replace(/\s+|[,]+\s/g,"").trim(),"bars class"+classLabel}).style("fill",function(t){return d(t.name)}),w.selectAll("rect").on("mouseover",function(){A.style("display",null)}).on("mouseout",function(){A.style("display","none")}).on("mousemove",function(t){var e=t.y1-t.y0,n=d3.mouse(this)[0]-40,r=d3.mouse(this)[1]-30;A.attr("transform","translate("+n+","+r+")").select("text").text((100*e).toFixed(1)+"%"),console.log(e)}),R=y.selectAll(".legend").data(d.domain().slice().reverse()).enter().append("g").attr("class",function(t){return g.push(t.replace(/\s+|[,]+\s/g,"")),m.push(t),"legend"}).attr("transform",function(t,e){return"translate(0,"+20*e+")"}),g=g.reverse(),m=m.reverse(),R.append("rect").attr("x",i-210).attr("width",18).attr("height",18).style("fill",d).attr("id",function(t,e){return"id"+t.replace(/\s+|[,]+\s/g,"")}).on("mouseover",function(){"0"===f?d3.select(this).style("cursor","pointer"):f.split("class").pop()===this.id.split("id").pop()?d3.select(this).style("cursor","pointer"):d3.select(this).style("cursor","auto")}).on("click",function(t){if("0"===f){for(d3.select(this).style("stroke","black").style("stroke-width",2),f=this.id.split("id").pop(),L(this),e=0;e<g.length;e++)g[e]!=f?d3.select("#id"+g[e]).style("opacity",.5):sortBy=e;d3.select("label").select("input").property("disabled",!1),d3.select("label").style("color","black"),d3.select("input").on("change",N)}else if(f===this.id.split("id").pop()){for(d3.select(this).style("stroke","none"),e=0;e<g.length;e++)d3.select("#id"+g[e]).style("opacity",1);d3.select("label").select("input").property("checked")&&(b=!0),d3.select("label").style("color","#D8D8D8").select("input").property("disabled",!0).property("checked",!1),N(),B(t),f="0"}}),R.append("text").attr("x",i-175).attr("y",8).attr("dy","0.32em").attr("font-size","14px").attr("font","sans-serif").attr("text-anchor","start").text(function(t){return t})})}return t}